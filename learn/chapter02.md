# レプリケーション
## 2-1. レプリケーションの基本構造
- 2つのDBに含まれるデータが同じであり、それに対して**加える変更も同じであれば、結果も同じ**
- 非同期型レプリケーション
  - あくまで、マスター側の変更ログをスレーブ側に**転送**している
  - ほんの僅かに遅れて、スレーブ側はマスターに追随する

![mysql-レプリケーション.PNG](../image/mysql-レプリケーション.png)

### バイナリログ
- MySQLサーバー上で発生したすべての変更を直列化し、記録する仕組み
  - 行った操作が記録されている

    | 操作 | 内容 |
    | :--- | :--- |
    | `SHOW BINARY LOGS` | バイナリログの確認 |
    | `SHOW BINLOG EVENYS` | バイナリログの中身の確認 |

- バイナリログには3種類の取り方がある

    | 種類 | 内容 | 弱点 |
    | :--- | :--- | :--- |
    | SBR（ステートメントベースレプリケーション） | SQL文そのものを記録する | UUIDなど、マスターとスレーブで実行結果が必ず一致しないSQLでも記録する。<br>そのため、マスターとスレーブでデータに差異が生じることがある<br>総じて**非決定性SQL**も保存するということ |
    | RBR（行ベースレプリケーション） | SQL実行時に変更が生じた行の変更前と変更後を記録する | **非決定性SQL**を保存しない代わりにバイナリログサイズが大きくなる |
    | MBR（Mixedベースレプリケーション） | 最初はSBRで保存をしようとし、非決定性SQLが出現したとき、RBRで記録する | ない |

### レプリケーションを構成するスレッド
#### マスタースレッド

#### スレーブI/Oスレッド

#### スレーブSQLスレッド